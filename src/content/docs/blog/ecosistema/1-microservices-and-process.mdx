---
title: "El Ecosistema en Acci√≥n: Microservicios y Procesos Clave de CodeDesignPlus"
date: 2025-07-17
lastUpdated: 2025-07-17
tags: ["CodeDesignPlus", "Ecosystem", "Microservices", "Architecture", "DDD", "CQRS", "Workflows"]
excerpt: "Iniciamos la segunda fase presentando el coraz√≥n de nuestra plataforma: el conjunto de microservicios y los procesos de negocio transversales que el ecosistema CodeDesignPlus resuelve por ti."
authors:
    - wclg
draft: true
---

import { Aside, Steps, Tabs, TabItem, FileTree, LinkCard } from '@astrojs/starlight/components';
import Default from '@astrojs/starlight/components/MarkdownContent.astro'
import ImageZoom from 'starlight-image-zoom/components/ImageZoom.astro'
import { Image } from 'astro:assets';

<ImageZoom/>


En la [primera fase de nuestra serie](/blog/env-dev/14-cierre-fase-infraestructura/), construimos meticulosamente el escenario: una plataforma robusta, segura y escalable sobre Kubernetes. Montamos las luces (Istio), el sonido (OpenTelemetry), la maquinaria interna (Vault, RabbitMQ, Redis) y la seguridad perimetral (Entra ID). Ahora, con el escenario listo, es hora de que los actores principales entren en escena.

Este art√≠culo marca el inicio de una nueva y emocionante fase: el despliegue del **ecosistema de microservicios base de CodeDesignPlus**. Estos no son servicios de ejemplo; son componentes de nivel de producci√≥n, reutilizables y listos para usar, que resuelven los problemas m√°s comunes y complejos del desarrollo de software. Su prop√≥sito es liberarnos para que podamos centrarnos en lo que realmente aporta valor: la l√≥gica de negocio de nuestra aplicaci√≥n de inventario.

### El Diagrama del Ecosistema

*(Aqu√≠ ir√° el diagrama del ecosistema)*

<Image src="/images/blogs/ecosistema/ecosystem-diagram.png" alt="Diagrama del Ecosistema de Microservicios CodeDesignPlus" width="2550" height="1314" decoding="async" loading="lazy"/>

Este diagrama visualiza c√≥mo cada microservicio tiene una responsabilidad √∫nica y c√≥mo se comunican entre s√≠ para formar un todo coherente.

### La Arquitectura Base: Patrones y Principios

Todos los microservicios del ecosistema CodeDesignPlus no son solo piezas de c√≥digo funcionales; est√°n construidos sobre una base arquitect√≥nica s√≥lida, siguiendo patrones de dise√±o probados en la industria para garantizar la mantenibilidad, escalabilidad y testabilidad.

*   **Ports and Adapters (Arquitectura Hexagonal):** Desacopla la l√≥gica de negocio del mundo exterior (bases de datos, APIs, etc.).
*   **CQRS (Command Query Responsibility Segregation):** Separa las operaciones de escritura (Comandos) de las de lectura (Consultas), permitiendo optimizar cada una de forma independiente.
*   **Event-Driven Architecture (EDA):** Fomenta la comunicaci√≥n as√≠ncrona a trav√©s de eventos, creando sistemas m√°s resilientes y desacoplados.
*   **Domain-Driven Design (DDD):** Modela el software en torno al dominio del negocio, asegurando que el c√≥digo hable el mismo lenguaje que los expertos en la materia.

<Aside  title="El ADN del Ecosistema: El Arquetipo">
La consistencia y calidad de todos estos microservicios provienen de un √∫nico punto de origen: el **Arquetipo de CodeDesignPlus**. Este arquetipo es una plantilla de proyecto que ya implementa todos estos patrones y las mejores pr√°cticas. Para conocer a fondo las caracter√≠sticas y la estructura interna de cualquier microservicio del ecosistema, basta con entender el arquetipo.

<LinkCard title="Explora el Arquetipo de CodeDesignPlus" href="/archetypes/" />
</Aside>

### Los Puntos de Entrada (Entrypoints)

Cada microservicio expone su funcionalidad a trav√©s de diferentes "puntos de entrada", adaptados a distintos casos de uso:

*   **REST üåê:** Punto de entrada s√≠ncrono basado en HTTP. Es la interfaz principal para ser consumida por aplicaciones web, m√≥viles o clientes de terceros.
*   **gRPC ‚ö°:** Un framework de comunicaci√≥n s√≠ncrona de alto rendimiento. Se utiliza principalmente para la comunicaci√≥n interna y cr√≠tica entre microservicios, donde la latencia es un factor clave.
*   **Async Worker ‚öôÔ∏è:** Un proceso en segundo plano que no expone una API directa. Su trabajo es escuchar eventos de dominio publicados en RabbitMQ por otros microservicios y disparar acciones de forma as√≠ncrona.

### Presentando a los Actores: Los Microservicios Base

A continuaci√≥n, presentamos cada uno de los microservicios que componen el n√∫cleo del ecosistema, agrupados por su funci√≥n principal.

#### Gesti√≥n de Identidad y Acceso
*   **`Users`**: Gestiona perfiles de usuario, incluyendo creaci√≥n y actualizaci√≥n. (REST, gRPC, Worker)
*   **`Roles`**: Administra los roles del sistema (ej. "Admin", "Lector"). (REST)
*   **`Rbac`**: Control de Acceso Basado en Roles. Permite a otros servicios consultar en tiempo de ejecuci√≥n si un usuario/rol tiene permiso para realizar una acci√≥n. (REST, gRPC)
*   **`MicrosoftGraph`**: Se integra con Microsoft Entra ID, gestionando la sincronizaci√≥n de usuarios y el enriquecimiento de tokens a trav√©s de las Custom Authentication Extensions. (REST, Worker)

#### N√∫cleo de la Plataforma y Negocio
*   **`Tenants`**: Gestiona los inquilinos (tenants) en una arquitectura multi-tenant, asociando a cada uno con su licencia. (REST, gRPC)
*   **`Licenses`**: Administra las licencias de software y los m√≥dulos que estas habilitan. (REST)
*   **`Modules`**: Define los m√≥dulos funcionales de la plataforma y sus endpoints asociados. (REST)
*   **`Services`**: Act√∫a como un registro de servicios. Los dem√°s microservicios se registran en √©l para permitir el descubrimiento. (REST, gRPC)
*   **`Payments`**: Orquesta la l√≥gica de pagos e se integra con diferentes proveedores. (REST, gRPC)

#### Servicios de Soporte y Datos
*   **`Catalogs`**: Proporciona una forma gen√©rica de gestionar cat√°logos comunes (ej. tipos de documento). (REST)
*   **`Emails`**: Se encarga del env√≠o de correos electr√≥nicos y la gesti√≥n de plantillas. (REST, gRPC, Worker)
*   **`FileStorage`**: Abstrae el almacenamiento de archivos, con soporte para proveedores como Azure Blob Storage, Azure File Storage o sistemas de archivos locales. (REST)
*   **`Locations`**: Gestiona datos geogr√°ficos complejos: pa√≠ses, estados, ciudades, barrios, zonas horarias y monedas. (REST)

---

### Presentando los Procesos Transversales Clave

Un ecosistema es m√°s que la suma de sus partes. El verdadero poder de CodeDesignPlus reside en c√≥mo estos microservicios colaboran para orquestar procesos de negocio complejos de forma predeterminada. A continuaci√≥n, exploraremos algunos de estos flujos de trabajo clave que obtienes "out-of-the-box".

#### 1. Proceso de Registro de Usuario Moderno y Desacoplado

El registro de un nuevo usuario en una aplicaci√≥n moderna es un proceso complejo. Nuestro ecosistema lo resuelve de la siguiente manera:

*(Aqu√≠ ir√° el diagrama de secuencia del proceso de registro)*
<Image src="/images/blogs/ecosistema/user-registration-flow.png" alt="Diagrama de flujo del registro de usuario" width="2550" height="1314" decoding="async" loading="lazy"/>

El flujo es el siguiente:
1.  **Inicio:** El usuario interact√∫a con la interfaz de registro generada por **Microsoft Entra External ID**.
2.  **Webhook de Sincronizaci√≥n:** Tras la recolecci√≥n de datos, Entra ID dispara la **Custom Authentication Extension (`AttributeCollectionSubmit`)**.
3.  **L√≥gica Centralizada:** La extensi√≥n invoca a nuestro microservicio **`ms-microsoft-graph`**, que act√∫a como adaptador.
4.  **Creaci√≥n Interna:** `ms-microsoft-graph` recibe los datos y publica un evento de dominio, como `UsuarioRegistradoEnProveedorExterno`.
5.  **Reacci√≥n As√≠ncrona:** El microservicio **`ms-users`** escucha este evento y crea la r√©plica del usuario en nuestra base de datos interna, asign√°ndole un ID √∫nico del ecosistema.
6.  **Enriquecimiento del Token:** En los siguientes inicios de sesi√≥n, la extensi√≥n `TokenIssuanceStart` se asegura de que el token JWT final contenga nuestro ID de usuario interno, desacoplando por completo nuestra l√≥gica del proveedor de identidad.

#### 2. Proceso de Adquisici√≥n de una Licencia

Este flujo muestra c√≥mo un `Tenant` puede adquirir una licencia, habilitando un conjunto espec√≠fico de funcionalidades en la plataforma.

*(Aqu√≠ ir√° el diagrama de flujo y/o capturas de la UI del proceso de licencia)*
<Image src="/images/blogs/ecosistema/license-acquisition-flow.png" alt="Flujo de adquisici√≥n de licencia" width="2550" height="1314" decoding="async" loading="lazy"/>

Este proceso orquesta la interacci√≥n entre los microservicios `ms-tenants`, `ms-licenses`, `ms-modules` y `ms-payments` para validar la compra, asignar la licencia correcta y habilitar los m√≥dulos correspondientes para el inquilino.

#### 3. Proceso de Configuraci√≥n Inicial y "Data Seeding"

Poner en marcha una nueva instancia de la aplicaci√≥n desde cero ("cold start") puede ser tedioso. El ecosistema facilita este proceso permitiendo una configuraci√≥n inicial guiada y el poblado de datos semilla.

*(Aqu√≠ ir√°n capturas de pantalla de las interfaces de administraci√≥n para la configuraci√≥n inicial)*
<Image src="/images/blogs/ecosistema/initial-setup-ui.png" alt="Interfaz de configuraci√≥n inicial" width="2550" height="1314" decoding="async" loading="lazy"/>

A trav√©s de las interfaces de administraci√≥n, un "Super Admin" puede realizar tareas esenciales como:
*   Crear los **roles** base del sistema (`ms-roles`).
*   Definir los **m√≥dulos** y **servicios** que componen la oferta de productos (`ms-modules`, `ms-services`).
*   Crear los diferentes niveles de **licencias** (`ms-licenses`).
*   Poblar los cat√°logos de **ubicaciones** con datos de pa√≠ses, estados y ciudades (`ms-locations`).
*   Configurar los **permisos** detallados para cada rol en cada microservicio (`ms-rbac`).

---

### ¬øQu√© Sigue? Profundizando en Cada Microservicio

Este art√≠culo es solo la introducci√≥n. En las pr√≥ximas gu√≠as, nos sumergiremos en el despliegue y configuraci√≥n de **cada uno de estos microservicios**. Para cada uno, cubriremos en detalle:

1.  **El Helm Chart:** Analizaremos su `values.yaml` y lo desplegaremos en nuestro cl√∫ster.
2.  **La Configuraci√≥n en Vault:** Crearemos y poblaremos los secretos necesarios para que el microservicio se inicie y funcione correctamente.
3.  **La Interacci√≥n y Uso:** Veremos c√≥mo interactuar con su API o c√≥mo responde a eventos, para entender su funcionalidad en la pr√°ctica.

<Aside type="note" title="Entorno de Desarrollo vs. Producci√≥n">
Una vez m√°s, nuestro enfoque inicial ser√° el despliegue en el **entorno de desarrollo** que hemos construido. En una futura serie de art√≠culos avanzados, exploraremos las consideraciones y configuraciones espec√≠ficas para llevar cada uno de estos componentes a un entorno de **producci√≥n** de alta disponibilidad.
</Aside>

¬°La base est√° construida, los actores y sus guiones est√°n presentados! En nuestro pr√≥ximo art√≠culo, comenzaremos con el primer despliegue. ¬°Prep√°rate para ver c√≥mo toda nuestra infraestructura cobra vida!